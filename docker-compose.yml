version: '3.8'

services:
  coffee-pathfinding:
    build: .
    container_name: panda-bear-coffee-project
    volumes:
      # ê²°ê³¼ íŒŒì¼ì„ í˜¸ìŠ¤íŠ¸ì™€ ê³µìœ 
      - ./result:/app/result
      # ë°ì´í„° íŒŒì¼ì„ í˜¸ìŠ¤íŠ¸ì™€ ê³µìœ  (ì½ê¸° ì „ìš©)
      - ./data:/app/data:ro
    environment:
      - PYTHONPATH=/app/src
      - PYTHONUNBUFFERED=1
    command: >
      sh -c "
        echo 'ğŸš€ Docker ì»¨í…Œì´ë„ˆì—ì„œ ë°˜ë‹¬ê³° ì»¤í”¼ ê²½ë¡œ íƒìƒ‰ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...' &&
        echo '1ï¸âƒ£ ë°ì´í„° ì „ì²˜ë¦¬ ë° ë¶„ì„ ì¤‘...' &&
        python src/caffee_map.py &&
        echo '2ï¸âƒ£ ê¸°ë³¸ ì§€ë„ ìƒì„± ì¤‘...' &&
        python src/map_draw.py &&
        echo '3ï¸âƒ£ BFS ê²½ë¡œ íƒìƒ‰ ë° TSP í•´ê²° ì¤‘...' &&
        python src/map_direct_save.py &&
        echo 'âœ… í”„ë¡œì íŠ¸ ì‹¤í–‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' &&
        echo 'ğŸ“ ê²°ê³¼ íŒŒì¼ë“¤ì€ ./result í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.' &&
        ls -la result/
      "
    # ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ì§€ ì•Šë„ë¡ ìœ ì§€
    tty: true
    stdin_open: true

  # ê°œë°œìš© ì„œë¹„ìŠ¤ (ëŒ€í™”í˜• ì‹¤í–‰)
  coffee-pathfinding-dev:
    build: .
    container_name: panda-bear-coffee-dev
    volumes:
      - ./result:/app/result
      - ./data:/app/data:ro
      - ./src:/app/src:ro
    environment:
      - PYTHONPATH=/app/src
      - PYTHONUNBUFFERED=1
    command: /bin/bash
    tty: true
    stdin_open: true
    profiles:
      - dev
